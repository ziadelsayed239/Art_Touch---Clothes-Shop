@model List<Art_Touch.Controllers.CartItem>

@{
    ViewData["Title"] = "Shopping Cart";
    Layout = "~/Views/Shared/_ShopLayout.cshtml";
}

<div style="padding: 80px 0; background: #f8f9fa; min-height: 80vh;">
    <div class="container">
        <h1 style="font-size: 36px; font-weight: bold; color: #333; margin-bottom: 40px; text-align: center;">Shopping Cart</h1>

        @if (!Model.Any())
        {
            <div style="text-align: center; padding: 60px 20px;">
                <i class="fas fa-shopping-bag" style="font-size: 64px; color: #ddd; margin-bottom: 20px;"></i>
                <h2 style="font-size: 24px; color: #666; margin-bottom: 15px;">Your cart is empty</h2>
                <p style="color: #999; margin-bottom: 30px;">Looks like you haven't added any items to your cart yet.</p>
                <a href="@Url.Action("Products", "Shop")" class="btn" style="background: #e91e63; color: white; padding: 12px 30px; border-radius: 25px; text-decoration: none; font-weight: 500;">
                    Continue Shopping
                </a>
            </div>
        }
        else
        {
            <div class="row">
                <div class="col-lg-8">
                    <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
                        @foreach (var item in Model)
                        {

                            <div class="cart-item" style="display: flex; align-items: center; padding: 20px 0; border-bottom: 1px solid #eee;">
                                <div class="cart-image-container">
                                    <img src="@item.CoverImageUrl" alt="@item.Product?.Name" class="cart-image" />
                                </div>






                                <div style="flex: 1;">
                                    <h3 style="font-size: 18px; font-weight: 600; color: #333; margin-bottom: 8px;">@item.Product?.Name</h3>
                                    <p style="color: #666; margin-bottom: 8px;">Size: @item.Size</p>
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <div style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 5px;">
                                            <button class="quantity-btn" data-product-id="@item.ProductId" data-size="@item.Size" data-action="decrease"
                                                    style="border: none; background: none; padding: 8px 12px; cursor: pointer;">
                                                -
                                            </button>
                                            <span class="quantity-display" style="padding: 8px 15px; min-width: 40px; text-align: center;">@item.Quantity</span>
                                            <button class="quantity-btn" data-product-id="@item.ProductId" data-size="@item.Size" data-action="increase"
                                                    style="border: none; background: none; padding: 8px 12px; cursor: pointer;">
                                                +
                                            </button>
                                        </div>
                                        <form asp-action="RemoveFromCart" method="post" style="display: inline;">
                                            <input type="hidden" name="productId" value="@item.ProductId" />
                                            <input type="hidden" name="size" value="@item.Size" />
                                            <button type="submit" style="background: none; border: none; color: #e91e63; cursor: pointer; font-size: 14px;">
                                                <i class="fas fa-trash"></i> Remove
                                            </button>
                                        </form>
                                    </div>
                                </div>

                                <div style="text-align: right; min-width: 120px;">
                                    <div style="font-size: 18px; font-weight: bold; color: #e91e63;">
                                        $@((item.Product?.DiscountPrice ?? item.Product?.OriginalPrice ?? 0) * item.Quantity)
                                    </div>
                                    @if (item.Product?.DiscountPrice.HasValue == true)
                                    {
                                        <div style="font-size: 14px; color: #999; text-decoration: line-through;">
                                            $@(item.Product.OriginalPrice * item.Quantity)
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <div class="col-lg-4">
                    <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); position: sticky; top: 20px;">
                        <h3 style="font-size: 24px; font-weight: bold; color: #333; margin-bottom: 20px;">Order Summary</h3>

                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #666;">Subtotal:</span>
                                <span style="font-weight: 500;">$@Model.Sum(i => (i.Product?.DiscountPrice ?? i.Product?.OriginalPrice ?? 0) * i.Quantity)</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #666;">Shipping:</span>
                                <span style="font-weight: 500;">Free</span>
                            </div>
                            <hr style="margin: 15px 0;" />
                            <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold;">
                                <span>Total:</span>
                                <span style="color: #e91e63;">$@Model.Sum(i => (i.Product?.DiscountPrice ?? i.Product?.OriginalPrice ?? 0) * i.Quantity)</span>
                            </div>
                        </div>

                        @if (User.Identity?.IsAuthenticated == true)
                        {
                            <a href="@Url.Action("Checkout", "Shop")" class="btn w-100" style="background: #e91e63; color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 500; text-align: center; margin-bottom: 15px;">
                                Proceed to Checkout
                            </a>
                        }
                        else
                        {
                            <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                <p style="color: #856404; margin: 0; font-size: 14px;">
                                    <i class="fas fa-info-circle"></i> Please <a href="@Url.Action("Login", "Account")" style="color: #e91e63;">login</a> to proceed with checkout.
                                </p>
                            </div>
                        }

                        <a href="@Url.Action("Products", "Shop")" class="btn w-100" style="border: 2px solid #e91e63; color: #e91e63; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 500; text-align: center; background: transparent;">
                            Continue Shopping
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>




<style>
    .cart-image-container {
        width: 160px;
        height:200px;
        aspect-ratio: 1 / 1;
        margin-right: 25px;
        border-radius: 12px;
        overflow: hidden;
        flex-shrink: 0;
    }

    .cart-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    /* ? Responsive adjustments for smaller screens */
    @@media (max-width: 768px) {
        .cart-image-container

    {
        width: 120px;
    }

    }

    @@media (max-width: 576px) {
        .cart-image-container

    {
        width: 100px;
    }

    }

    @@media (max-width: 400px) {
        .cart-image-container

    {
        width: 80px;
    }

    }</style>







<script>
    document.addEventListener('DOMContentLoaded', function () {
        const quantityBtns = document.querySelectorAll('.quantity-btn');

        quantityBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                const productId = this.dataset.productId;
                const size = this.dataset.size;
                const action = this.dataset.action;
                const quantityDisplay = this.parentElement.querySelector('.quantity-display');
                let currentQuantity = parseInt(quantityDisplay.textContent);

                if (action === 'increase') {
                    currentQuantity++;
                } else if (action === 'decrease' && currentQuantity > 1) {
                    currentQuantity--;
                }

                // Update display
                quantityDisplay.textContent = currentQuantity;

                // Send AJAX request to update cart
                fetch('@Url.Action("UpdateCart", "Shop")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `productId=${productId}&size=${size}&quantity=${currentQuantity}`
                }).then(() => {
                    // Reload page to update totals
                    window.location.reload();
                });
            });
        });
    });
</script>
