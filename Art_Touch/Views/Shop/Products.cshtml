@model List<DAL.Data.Models.Product>
@{
    ViewData["Title"] = "Products";
    Layout = "~/Views/Shared/_ShopLayout.cshtml";
}

<!-- Page Header -->
<div class="page-header">
    <div class="container">
        <h1>Our Products</h1>
        <p>Discover our collection of artistic women's clothing and accessories</p>
    </div>
</div>

<div style="padding: 0 0 80px; background: #f8f9fa; min-height: 60vh;">
    <div class="container">


        <!-- Filters and Sort -->
        <div style="background: white; border-radius: 15px; padding: 20px; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <label for="categoryFilter" style="font-weight: 500; color: #333; margin-right: 10px;">Category:</label>
                    <select id="categoryFilter" class="form-control" style="display: inline-block; width: auto; padding: 8px 15px; border-radius: 8px; border: 1px solid #ddd;">
                        <option value="">All Categories</option>
                        @if (ViewBag.Categories != null)
                        {
                            @foreach (var category in ViewBag.Categories)
                            {
                                <option value="@category.Id" @@(ViewBag.CurrentCategory?.ToString() == category.Id.ToString() ? "selected" : "")>
                                    @category.Name
                                </option>
                            }
                        }
                    </select>
                </div>
                <div class="col-md-6 text-end">
                    <label for="sortBy" style="font-weight: 500; color: #333; margin-right: 10px;">Sort by:</label>
                    <select id="sortBy" class="form-control" style="display: inline-block; width: auto; padding: 8px 15px; border-radius: 8px; border: 1px solid #ddd;">
                        <option value="newest" @@(ViewBag.CurrentSort?.ToString() == "newest" ? "selected" : "")>Newest First</option>
                        <option value="price_low" @@(ViewBag.CurrentSort?.ToString() == "price_low" ? "selected" : "")>Price: Low to High</option>
                        <option value="price_high" @@(ViewBag.CurrentSort?.ToString() == "price_high" ? "selected" : "")>Price: High to Low</option>
                        <option value="name" @@(ViewBag.CurrentSort?.ToString() == "name" ? "selected" : "")>Name: A to Z</option>
                    </select>
                </div>
            </div>
        </div>

        @if (!Model.Any())
        {
            <div style="text-align: center; padding: 60px 20px;">
                <i class="fas fa-search" style="font-size: 64px; color: #ddd; margin-bottom: 20px;"></i>
                <h2 style="font-size: 24px; color: #666; margin-bottom: 15px;">No products found</h2>
                <p style="color: #999; margin-bottom: 30px;">Try adjusting your filters or browse all categories.</p>
                <a href="@Url.Action("Products", "Shop")" class="btn" style="background: #e91e63; color: white; padding: 12px 30px; border-radius: 25px; text-decoration: none; font-weight: 500;">
                    View All Products
                </a>
            </div>
        }
        else
        {
            <div class="products-grid">
                @foreach (var product in Model)
                {
                    <div class="product-card">
                        <div class="product-image">
                            @if (product.IsNewArrival)
                            {
                                <span class="product-badge new">New</span>
                            }
                            @if (product.IsBestseller)
                            {
                                <span class="product-badge bestseller">Best Seller</span>
                            }
                            <img src="@(product.Images != null && product.Images.Count > 0 ? product.Images.First().ImageUrl : "/images/placeholder-dress.jpg")" 
                                 alt="@product.Name" 
                                 onerror="this.src='/images/placeholder-dress.jpg'; this.onerror=null;" />
                            <div class="product-overlay">
                                <a href="@Url.Action("ProductDetails", "Shop", new { id = product.Id })" class="btn-view-details">
                                    <i class="fas fa-eye"></i> View Details
                                </a>
                                <button class="btn-add-to-cart" data-product-id="@product.Id">
                                    <i class="fas fa-shopping-cart"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                        <div class="product-info">
                            <h3>@product.Name</h3>
                            <p class="product-category">@(string.IsNullOrEmpty(product.Description) ? product.Category?.Name : product.Description)</p>
                            <div class="product-price">
                                @if (product.DiscountPrice.HasValue)
                                {
                                    <span class="price-current">$@product.DiscountPrice.Value.ToString("F2")</span>
                                    <span class="price-original">$@product.OriginalPrice.ToString("F2")</span>
                                }
                                else
                                {
                                    <span class="price-current">$@product.OriginalPrice.ToString("F2")</span>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const categoryFilter = document.getElementById('categoryFilter');
    const sortBy = document.getElementById('sortBy');
    
    function updateProducts() {
        const category = categoryFilter.value;
        const sort = sortBy.value;
        const url = new URL(window.location);
        
        if (category) {
            url.searchParams.set('categoryId', category);
        } else {
            url.searchParams.delete('categoryId');
        }
        
        if (sort) {
            url.searchParams.set('sortBy', sort);
        } else {
            url.searchParams.delete('sortBy');
        }
        
        window.location.href = url.toString();
    }
    
    categoryFilter.addEventListener('change', updateProducts);
    sortBy.addEventListener('change', updateProducts);
    
    // Add to cart functionality
    const addToCartButtons = document.querySelectorAll('.btn-add-to-cart');
    addToCartButtons.forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.dataset.productId;
            
            fetch('@Url.Action("AddToCart", "Shop")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `productId=${productId}&quantity=1`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update cart count
                    const cartCount = document.querySelector('.cart-count');
                    if (cartCount) {
                        cartCount.textContent = data.cartCount;
                    }
                    
                    // Show success message
                    this.innerHTML = '<i class="fas fa-check"></i> Added!';
                    this.style.background = '#4caf50';
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-shopping-cart"></i> Add to Cart';
                        this.style.background = '#e91e63';
                    }, 2000);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding to cart. Please try again.');
            });
        });
    });
});
</script> 